<!DOCTYPE html>
<html>
	<head>
		<title>Simple Prediction</title>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<!-- Latest compiled and minified CSS -->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">

		<!-- jQuery library -->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

		<!-- Popper JS -->
		<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>

		<!-- Latest compiled JavaScript -->
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

		<script src="https://unpkg.com/brain.js"></script>
	</head>
	<body>
		<div class="container-fluid">

			<div class="row">
				<div class="col-12">
					<div id="wrapper">
				
					</div>
				</div>
			</div>
  
		</div>
		
		<script>
			// rawData = [{ open: number, high: number, low: number, close: number }]	  
			const rawData = [
				{"open":1341.55,"high":1368.14,"low":1341.55,"close":1367.37},
				{"open":1347.86,"high":1372.5,"low":1345.54,"close":1360.66},
				{"open":1350,"high":1396.5,"low":1350,"close":1394.21},
				{"open":1397.94,"high":1402.99,"low":1390.38,"close":1393.34},
				{"open":1392.08,"high":1411.58,"low":1390.84,"close":1404.32},
				{"open":1420.57,"high":1427.33,"low":1410.27,"close":1419.83},
				{"open":1427.56,"high":1434.93,"low":1418.35,"close":1429.73},
				{"open":1436.13,"high":1440.52,"low":1426.02,"close":1439.23},
				{"open":1439.01,"high":1441.8,"low":1428.37,"close":1430.88},
				{"open":1430.21,"high":1441.4,"low":1430.21,"close":1439.2},
				{"open":1447.44,"high":1451.99,"low":1440.92,"close":1451.7},
				{"open":1462.91,"high":1481.3,"low":1458.22,"close":1480.39},
				{"open":1479.12,"high":1491.85,"low":1471.2,"close":1484.4},
				{"open":1491,"high":1503.21,"low":1484.93,"close":1485.95},
				{"open":1487.64,"high":1495.52,"low":1482.1,"close":1486.65},
				{"open":1493.59,"high":1495.5,"low":1465.25,"close":1466.71},
				{"open":1431,"high":1438.07,"low":1421.2,"close":1433.9},
				{"open":1443,"high":1456,"low":1432.47,"close":1452.56},
				{"open":1458.8,"high":1465.43,"low":1446.74,"close":1458.63},
				{"open":1439.96,"high":1457.28,"low":1436.4,"close":1455.84},
				{"open":1468.9,"high":1470.13,"low":1428.53,"close":1434.23},
				{"open":1462,"high":1490,"low":1458.99,"close":1485.94},
				{"open":1457.07,"high":1469.5,"low":1426.3,"close":1447.07},
				{"open":1462.42,"high":1463.84,"low":1430.56,"close":1448.23},
				{"open":1450.33,"high":1482,"low":1449.57,"close":1476.23},
				{"open":1467.3,"high":1485.84,"low":1466.35,"close":1479.23},
				{"open":1474.32,"high":1509.5,"low":1474.32,"close":1508.68},
				{"open":1511.81,"high":1529.63,"low":1505.64,"close":1508.79},
				{"open":1514.48,"high":1520.7,"low":1508.11,"close":1518.27},
				{"open":1512.69,"high":1527.18,"low":1504.6,"close":1514.66},
				{"open":1515.6,"high":1520.74,"low":1507.34,"close":1520.74},
				{"open":1515,"high":1531.63,"low":1512.59,"close":1519.67},
				{"open":1525.07,"high":1532.11,"low":1521.4,"close":1526.69},
				{"open":1522,"high":1529.64,"low":1506.82,"close":1518.15},
				{"open":1508.03,"high":1512.22,"low":1480.44,"close":1485.11},
				{"open":1426.11,"high":1436.97,"low":1411.39,"close":1421.59},
				{"open":1433,"high":1438.14,"low":1382.4,"close":1388.45},
				{"open":1396.14,"high":1415.7,"low":1379,"close":1393.18},
				{"open":1362.06,"high":1371.7,"low":1317.17,"close":1318.09},
				{"open":1277.5,"high":1341.14,"low":1271,"close":1339.33},
				{"open":1351.61,"high":1390.87,"low":1326.82,"close":1389.11},
				{"open":1399.42,"high":1410.15,"low":1332,"close":1341.39},
				{"open":1359.23,"high":1388.09,"low":1343.11,"close":1386.52},
				{"open":1350.2,"high":1358.91,"low":1305.1,"close":1319.04},
				{"open":1277.06,"high":1306.22,"low":1261.05,"close":1298.41},
				{"open":1205.3,"high":1254.76,"low":1200,"close":1215.56},
				{"open":1260,"high":1281.15,"low":1218.77,"close":1280.39},
				{"open":1249.7,"high":1260.96,"low":1196.07,"close":1215.41},
				{"open":1126,"high":1193.87,"low":1113.3,"close":1114.91},
				{"open":1179,"high":1219.76,"low":1117.14,"close":1219.73},
				{"open":1096,"high":1152.27,"low":1074.44,"close":1084.33},
				{"open":1093.11,"high":1130.86,"low":1056.01,"close":1119.8},
				{"open":1056.51,"high":1106.5,"low":1037.28,"close":1096.8},
				{"open":1093.05,"high":1157.97,"low":1060.11,"close":1115.29},
				{"open":1135.72,"high":1143.99,"low":1065.49,"close":1072.32},
				{"open":1061.32,"high":1071.32,"low":1013.54,"close":1056.62},
				{"open":1103.77,"high":1135,"low":1090.62,"close":1134.46},
				{"open":1126.47,"high":1148.9,"low":1086.01,"close":1102.49},
				{"open":1111.8,"high":1169.97,"low":1093.53,"close":1161.75},
				{"open":1125.67,"high":1150.67,"low":1105.91,"close":1110.71},
				{"open":1125.04,"high":1151.63,"low":1096.48,"close":1146.82},
				{"open":1147.3,"high":1175.31,"low":1138.14,"close":1162.81},
				{"open":1122,"high":1129.69,"low":1097.45,"close":1105.62},
				{"open":1098.26,"high":1126.86,"low":1096.4,"close":1120.84},
				{"open":1119.02,"high":1123.54,"low":1079.81,"close":1097.88},
				{"open":1138,"high":1194.66,"low":1130.94,"close":1186.92},
				{"open":1221,"high":1225,"low":1182.23,"close":1186.51},
				{"open":1206.5,"high":1219.07,"low":1188.16,"close":1210.28},
				{"open":1224.08,"high":1225.57,"low":1196.74,"close":1211.45},
				{"open":1209.18,"high":1220.51,"low":1187.6,"close":1217.56},
				{"open":1245.09,"high":1282.07,"low":1236.93,"close":1269.23},
				{"open":1245.61,"high":1280.46,"low":1240.4,"close":1262.47},
				{"open":1274.1,"high":1279,"low":1242.62,"close":1263.47},
				{"open":1284.85,"high":1294.43,"low":1271.23,"close":1283.25},
				{"open":1271,"high":1281.6,"low":1261.37,"close":1266.61},
				{"open":1247,"high":1254.27,"low":1209.71,"close":1216.34},
				{"open":1245.54,"high":1285.61,"low":1242,"close":1263.21},
				{"open":1271.55,"high":1293.31,"low":1265.67,"close":1276.31},
				{"open":1261.17,"high":1280.4,"low":1249.45,"close":1279.31},
				{"open":1296,"high":1296.15,"low":1269,"close":1275.88},
				{"open":1287.93,"high":1288.05,"low":1232.2,"close":1233.67},
				{"open":1341.46,"high":1359.99,"low":1325.34,"close":1341.48},
				{"open":1324.88,"high":1352.82,"low":1322.49,"close":1348.66},
				{"open":1328.5,"high":1352.07,"low":1311,"close":1320.61},
				{"open":1308.23,"high":1327.66,"low":1299,"close":1326.8},
				{"open":1337.92,"high":1373.94,"low":1337.46,"close":1351.11},
				{"open":1361.69,"high":1371.12,"low":1347.29,"close":1347.3},
				{"open":1365.94,"high":1377.6,"low":1355.27,"close":1372.56},
				{"open":1383.13,"high":1398.76,"low":1375.48,"close":1388.37},
				{"open":1378.28,"high":1416.53,"low":1377.15,"close":1403.26},
				{"open":1407.12,"high":1415,"low":1374.77,"close":1375.74},
				{"open":1377.05,"high":1385.48,"low":1328.4,"close":1349.33},
				{"open":1335.02,"high":1357.42,"low":1323.91,"close":1356.13},
				{"open":1350,"high":1374.48,"low":1339,"close":1373.19},
				{"open":1361.75,"high":1392.33,"low":1354.25,"close":1383.94},
				{"open":1387,"high":1392,"low":1373.49,"close":1373.49},
				{"open":1389.58,"high":1410.42,"low":1387.25,"close":1406.72},
				{"open":1408,"high":1415.49,"low":1393.45,"close":1402.8},
				{"open":1396.71,"high":1412.76,"low":1391.83,"close":1410.42},
				{"open":1437.27,"high":1441,"low":1412.13,"close":1417.02},
				{"open":1417.25,"high":1421.74,"low":1391.29,"close":1417.84},
				{"open":1396.86,"high":1440.84,"low":1396,"close":1416.73},
				{"open":1416.94,"high":1432.57,"low":1413.35,"close":1428.92},
				{"open":1418.39,"high":1437.96,"low":1418,"close":1431.82},
				{"open":1430.55,"high":1439.61,"low":1418.83,"close":1439.22},
				{"open":1438.3,"high":1446.55,"low":1429.78,"close":1436.38},
				{"open":1430.4,"high":1438.96,"low":1404.73,"close":1412.18},
				{"open":1413.17,"high":1445.05,"low":1406,"close":1438.39},
				{"open":1422.34,"high":1447.99,"low":1422.34,"close":1446.61},
				{"open":1445.36,"high":1468,"low":1443.21,"close":1456.16},
				{"open":1459.54,"high":1474.26,"low":1456.27,"close":1465.85},
				{"open":1442.48,"high":1454.48,"low":1402,"close":1403.84},
				{"open":1428.49,"high":1437,"low":1386.02,"close":1413.18},
				{"open":1390.8,"high":1424.8,"low":1387.92,"close":1419.85},
				{"open":1445.22,"high":1455.02,"low":1425.9,"close":1442.72},
				{"open":1447.16,"high":1460,"low":1431.38,"close":1451.12},
				{"open":1449.16,"high":1451.41,"low":1427.01,"close":1435.96},
				{"open":1444,"high":1447.8,"low":1421.35,"close":1431.72},
				{"open":1429,"high":1452.75,"low":1423.21,"close":1451.86},
				{"open":1455.64,"high":1475.94,"low":1445.24,"close":1464.41},
				{"open":1461.51,"high":1475.42,"low":1429.75,"close":1431.97},
				{"open":1429.9,"high":1442.9,"low":1420,"close":1441.33},
				{"open":1431.39,"high":1433.45,"low":1351.99,"close":1359.9},
				{"open":1358.18,"high":1395.6,"low":1347.01,"close":1394.97},
				{"open":1390.44,"high":1418.65,"low":1383.96,"close":1413.61},
				{"open":1411.1,"high":1443,"low":1409.82,"close":1438.04},
				{"open":1446.94,"high":1482.95,"low":1446.42,"close":1464.7},
				{"open":1480.06,"high":1506.59,"low":1472.86,"close":1495.7},
				{"open":1490,"high":1516.8,"low":1483.55,"close":1485.18},
				{"open":1494.32,"high":1505.88,"low":1485.63,"close":1496},
				{"open":1506.45,"high":1522.72,"low":1488.09,"close":1510.99},
				{"open":1506.15,"high":1543.83,"low":1496.54,"close":1541.74},
				{"open":1550,"high":1577.13,"low":1505.24,"close":1511.34},
				{"open":1490.31,"high":1522.95,"low":1483.5,"close":1520.58},
				{"open":1523.13,"high":1535.33,"low":1498,"close":1513.64},
				{"open":1500,"high":1518.69,"low":1486.31,"close":1518},
				{"open":1521.62,"high":1523.44,"low":1498.42,"close":1515.55},
				{"open":1515.26,"high":1570.29,"low":1503.6,"close":1565.72},
				{"open":1586.99,"high":1586.99,"low":1554.28,"close":1558.42},
				{"open":1560.5,"high":1570,"low":1546.1,"close":1568.49},
				{"open":1566.97,"high":1571.87,"low":1507.39,"close":1515.68},
				{"open":1498.93,"high":1517.64,"low":1488.4,"close":1511.87},
				{"open":1515.6,"high":1540.97,"low":1515.21,"close":1530.2},
				{"open":1525.18,"high":1526.48,"low":1497.66,"close":1500.34},
				{"open":1506.32,"high":1531.25,"low":1501.33,"close":1522.02},
				{"open":1497,"high":1537.87,"low":1492.22,"close":1531.45},
				{"open":1505.01,"high":1508.95,"low":1454.03,"close":1482.96},
				{"open":1486.64,"high":1490.47,"low":1465.64,"close":1474.45},
				{"open":1476.57,"high":1485.56,"low":1458.65,"close":1464.97},
				{"open":1469.3,"high":1482.41,"low":1463.46,"close":1473.61},
				{"open":1471.75,"high":1502.39,"low":1466,"close":1500.1},
				{"open":1500,"high":1516.85,"low":1481.64,"close":1494.49},
				{"open":1487.18,"high":1504.08,"low":1473.08,"close":1496.1},
				{"open":1492.44,"high":1510,"low":1478,"close":1480.32},
				{"open":1485.58,"high":1512.39,"low":1485.25,"close":1506.62},
				{"open":1510.34,"high":1537.25,"low":1508.01,"close":1518.45},
				{"open":1515.66,"high":1521.9,"low":1502.88,"close":1507.73},
				{"open":1514.67,"high":1525.61,"low":1507.97,"close":1517.98},
				{"open":1526.18,"high":1562.47,"low":1523.71,"close":1558.6},
				{"open":1553.31,"high":1573.68,"low":1543.95,"close":1547.53},
				{"open":1543.45,"high":1585.87,"low":1538.2,"close":1581.75},
				{"open":1577.03,"high":1597.72,"low":1568.01,"close":1580.42},
				{"open":1593.98,"high":1614.17,"low":1580.57,"close":1588.2},
				{"open":1582.07,"high":1611.62,"low":1582.07,"close":1608.22},
				{"open":1608,"high":1659.22,"low":1603.6,"close":1652.38},
				{"open":1653.68,"high":1655,"low":1625.75,"close":1634.33},
				{"open":1633.49,"high":1647.17,"low":1630.75,"close":1644.41},
				{"open":1647.89,"high":1647.97,"low":1630.31,"close":1634.18},
				{"open":1636.63,"high":1665.73,"low":1632.22,"close":1660.71},
				{"open":1673.78,"high":1733.18,"low":1666.33,"close":1728.28},
				{"open":1709.71,"high":1709.71,"low":1615.06,"close":1641.84},
				{"open":1624.26,"high":1645.11,"low":1547.61,"close":1591.04}
			];

			function scaleDown(step) { // normalize
				return {
					open: step.open / 1600,
					high: step.high / 1600,
					low: step.low / 1600,
					close: step.close / 1600
				};
			}
			
			//console.log(scaleDown(rawData[0]));
			
			function scaleUp(step) { // denormalize
				return {
					open: step.open * 1600,
					high: step.high * 1600,
					low: step.low * 1600,
					close: step.close * 1600
				};
			}
			
			// bonus 
			// open: (step.open - lowest) / (highest - lowest),
			// open: (140 - 138) / (147 - 138)
			// actually equals:
			// 140 - 138 = 2
			// 147 - 138 = 9
			// 2 / 9 = 0.22222222
			
			const scaledData = rawData.map(scaleDown);
			
			const trainingData = [
				scaledData.slice(0, 5),
				scaledData.slice(5, 10),
				scaledData.slice(10, 15),
				scaledData.slice(15, 20),
			];

			const net = new brain.recurrent.LSTMTimeStep({
				inputSize: 4,
				hiddenLayers: [8, 8],
				outputSize: 4
			});			
			
			
			net.train(trainingData, {
				learningRate: 0.005,
				errorThresh: 0.02,
				// log: (stats) => console.log(stats)
			});

			
			const result = scaleUp(net.run(trainingData[1]));
			
			console.log(result);
			
			$('#wrapper').text("open:"+result.open+", high:"+result.high+", low:"+result.low+", close:"+result.close);

			
		</script>
	</body>
</html>